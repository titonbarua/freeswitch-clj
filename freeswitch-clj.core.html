<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>freeswitch-clj.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Freeswitch-clj</span> <span class="project-version">0.2.2-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="tutorial.html"><div class="inner"><span>Tutorial</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="freeswitch-clj.core.html"><div class="inner"><span>freeswitch-clj.core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="freeswitch-clj.core.html#var-bind-event"><div class="inner"><span>bind-event</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-close"><div class="inner"><span>close</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-disconnect"><div class="inner"><span>disconnect</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-listen"><div class="inner"><span>listen</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req"><div class="inner"><span>req</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-api"><div class="inner"><span>req-api</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-bgapi"><div class="inner"><span>req-bgapi</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-call-execute"><div class="inner"><span>req-call-execute</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-cmd"><div class="inner"><span>req-cmd</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-event"><div class="inner"><span>req-event</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-sendevent"><div class="inner"><span>req-sendevent</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-req-sendmsg"><div class="inner"><span>req-sendmsg</span></div></a></li><li class="depth-1"><a href="freeswitch-clj.core.html#var-unbind-event"><div class="inner"><span>unbind-event</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">freeswitch-clj.core</h1><div class="doc"><div class="markdown"><p>Contains functions to communicate with freeswitch using ESL.</p></div></div><div class="public anchor" id="var-bind-event"><h3>bind-event</h3><div class="usage"><code>(bind-event conn handler &amp; {:as event-headers})</code></div><div class="doc"><div class="markdown"><p>Bind a handler function to the event.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
  <li><code>handler</code> - The event handler function. It’s signature should be:  <code>(fn [conn event-map])</code>. Handler return value does not  matter.</li>
</ul>
<p><strong>Kwargs:</strong></p>
<p>All key value pairs are treated as event headers to match against.</p>
<p><strong>Returns:</strong></p>
<p><code>nil</code></p>
<p><strong>Usage Example:</strong></p>
<pre><code>;; Set a catch-all-stray event handler.
(bind-event conn
            (fn [conn event]
              (println "I match all stray events!")))

;; Create a BACKGROUND_JOB event handler.
(bind-event conn
            (fn [conn event]
              (println "I match all BG_JOB events."))
            :event-name "BACKGROUND_JOB")

;; Create BACKGROUND_JOB event handler for a specific job-uuid.
(bind-event conn
            (fn [conn event]
              (println "I match BG_JOB with specific UUID."))
            :event-name "BACKGROUND_JOB"
            :job-uuid "1234")
</code></pre>
<p><strong>Note:</strong></p>
<ul>
  <li>This does not send an ‘event’ command to freeswitch.</li>
  <li>Generally, you should use it’s higher-level cousin: <a href="freeswitch-clj.core.html#var-req-event">req-event</a>.</li>
  <li>Only one event handler is allowed per match criteria. New bindings  override the old ones.</li>
  <li>Specific handlers has higher priority than generalized ones.  The catch-all-stray handler has lowest priority.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L156">view source</a></div></div><div class="public anchor" id="var-close"><h3>close</h3><div class="usage"><code>(close {:keys [aleph-stream event-chan closed?], :as conn})</code></div><div class="doc"><div class="markdown"><p>Close a freeswitch connection.</p>
<p><strong>Note:</strong></p>
<p>Normally, you should use <a href="freeswitch-clj.core.html#var-disconnect">disconnect</a> function to gracefully disconnect, which sends protocol epilogue.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L296">view source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect &amp; {:keys [host port password], :or {host "127.0.0.1", port 8021, password "ClueCon"}, :as kwargs})</code></div><div class="doc"><div class="markdown"><p>Make an inbound connection to freeswitch.</p>
<p><strong>Kwargs:</strong></p>
<ul>
  <li><code>:host</code> - (optional) Hostname or ipaddr of the freeswitch ESL server.  Defaults to <code>"127.0.0.1"</code>.</li>
  <li><code>:port</code> - (optional) Port where freeswitch is listening.  Defaults to <code>8021</code>.</li>
  <li><code>:password</code> - (optional) Password for freeswitch inbound connection.  Defaults to <code>"ClueCon"</code>.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A map describing the connection.</p>
<p><strong>Note:</strong></p>
<p>Blocks until authentication step is complete.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L378">view source</a></div></div><div class="public anchor" id="var-disconnect"><h3>disconnect</h3><div class="usage"><code>(disconnect conn)</code></div><div class="doc"><div class="markdown"><p>Gracefully disconnect from freeswitch by sending an ‘exit’ command.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
</ul>
<p><strong>Returns:</strong></p>
<p><code>nil</code></p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L463">view source</a></div></div><div class="public anchor" id="var-listen"><h3>listen</h3><div class="usage"><code>(listen &amp; {:keys [port handler], :as kwargs})</code></div><div class="doc"><div class="markdown"><p>Listen for outbound connections from freeswitch.</p>
<p><strong>Kwargs:</strong></p>
<ul>
  <li><code>:port</code> - Port to listen for freeswitch connections.</li>
  <li><code>:handler</code> - A function with signature: <code>(fn [conn chan-data])</code>.  <code>conn</code> is a connection map which can be used with any  requester function, like: <a href="freeswitch-clj.core.html#var-req-cmd">req-cmd</a>, <a href="freeswitch-clj.core.html#var-req-api">req-api</a> etc.  <code>chan-data</code> is information about current channel.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>An aleph server object.</p>
<p><strong>Notes:</strong></p>
<ul>
  <li>Connection auto listens for ‘myevents’. But no event handler is bound.</li>
  <li>To stop listening for connections, call <code>.close</code> method of the returned  server object.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L434">view source</a></div></div><div class="public anchor" id="var-req"><h3>req</h3><div class="usage"><code>(req conn cmd-line cmd-hdrs cmd-body)</code></div><div class="doc"><div class="markdown"><p>Make a request to freeswitch.</p>
<p>Args: * conn - Freeswitch connection.</p>
<p>Returns: An <code>async/promise-chan</code> which returns the response when available.</p>
<p>NOTE: This is a low level function, intended to be used by other high-level functions like <code>req-cmd</code> etc.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L110">view source</a></div></div><div class="public anchor" id="var-req-api"><h3>req-api</h3><div class="usage"><code>(req-api conn api-cmd)</code></div><div class="doc"><div class="markdown"><p>Convenience function to make an api request.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
  <li><code>api-cmd</code> - Api command string with arguments.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A response map with following keys:  * <code>:ok</code> - Whether the operation succeeded.  * <code>:result</code> - The result of the api request.</p>
<p><strong>Usage Example:</strong></p>
<pre><code>;; Send a 'status' api request.
(println (req-api conn "status"))
</code></pre></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L512">view source</a></div></div><div class="public anchor" id="var-req-bgapi"><h3>req-bgapi</h3><div class="usage"><code>(req-bgapi conn handler api-cmd)</code></div><div class="doc"><div class="markdown"><p>Make a background api request.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
  <li><code>handler</code> - Result handler function. Signature is: <code>(fn [conn rslt])</code>.  <code>rslt</code> is a map with following keys:  * <code>:ok</code> - Designates success of api operation.  * <code>:result</code> - Result of the api command.  * <code>:event</code> - The event which delivered the result.</li>
  <li><code>api-cmd</code> - Api command string with arguments.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>The command response (not the api result).</p>
<p><strong>Usage Example:</strong></p>
<pre><code>;; Execute a 'status' api request in background.
(req-bgapi
  conn
  (fn [conn rslt] (println rslt))
  "status")
</code></pre></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L536">view source</a></div></div><div class="public anchor" id="var-req-call-execute"><h3>req-call-execute</h3><div class="usage"><code>(req-call-execute conn app-cmd &amp; {:keys [chan-uuid event-uuid start-handler end-handler event-lock loops], :or {event-lock false, loops 1}, :as kwargs})</code></div><div class="doc"><div class="markdown"><p>Send a ‘sendmsg’ request to a channel (or current channel, in case of freeswitch-outbound mode) to execute a dialplan application.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>app-cmd</code> - The dialplan app to execute, including it’s arguments.  i.e. “playback /tmp/myfile.wav”</li>
</ul>
<p><strong>Kwargs:</strong></p>
<ul>
  <li><code>:chan-uuid</code> - The UUID of the target channel. Unnecessary in outbound mode.</li>
  <li><code>:event-uuid</code> - (optional) An UUID to track the events generated by the command.  If not provided, a random UUID is used. Note that as of freeswitch  1.6, this UUID is returned as value of the <code>:application-uuid</code> header  of the event.</li>
  <li><code>:start-handler</code> - (optional) Function to process the ‘CHANNEL_EXECUTE’ event.</li>
  <li><code>:end-handler</code> - (optional) Function to process the ‘CHANNEL_EXECUTE_COMPLETE’ event.</li>
  <li><code>:event-lock</code> - (optional) Whether to execute apps in sync. Defaults to false.</li>
  <li><code>:loops</code> - (optional) The number of times the app will be executed. Defaults to 1.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>Command response.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L723">view source</a></div></div><div class="public anchor" id="var-req-cmd"><h3>req-cmd</h3><div class="usage"><code>(req-cmd conn cmd)</code></div><div class="doc"><div class="markdown"><p>Send a simple command request.</p>
<p><strong>Args:</strong></p>
<ul>
  <li>conn - The connection map.</li>
  <li>cmd - The command string including additional arguments.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A response map with key <code>:ok</code> bound to a boolean value describing success of the operation.</p>
<p><strong>Usage Example:</strong></p>
<pre><code>;; Send a 'noevents' command.
(req-cmd conn "noevents")
</code></pre>
<p><strong>Note:</strong></p>
<p>Don’t use this function to send special commands, like - ‘bgapi’, ‘sendmsg’ etc. Rather use the high level functions provided for each.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L480">view source</a></div></div><div class="public anchor" id="var-req-event"><h3>req-event</h3><div class="usage"><code>(req-event conn handler &amp; {:keys [event-name], :as event-headers})</code></div><div class="doc"><div class="markdown"><p>Request to listen for an event and bind a handler for it.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
  <li><code>handler</code> - Event handler function with signature:  <code>(fn [conn event-map])</code>.</li>
</ul>
<p><strong>Kwargs:</strong></p>
<ul>
  <li><code>:event-name</code> - Name of the event. Special value <code>ALL</code> means  subscribe to all events and the handler matches  any value for <code>:event-name.</code></li>
  <li>All other keyword arguments are treated as event headers  to match against. Like <code>:event-subclass</code> to match for custom  events.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>Response of the event command.</p>
<p><strong>Usage Examples:</strong></p>
<p>;; Listen for a regular event.  (req-event  conn  (fn <a href="println" title="Got a call update!">conn event</a>)  :event-name “CALL_UPDATE”)</p>
<p>;; Listen for a custom event with specific subclass.  (req-event  conn  (fn <a href="println" title="Inside a menu!">conn event</a>)  :event-name “CUSTOM”  :event-subclass “menu:enter”)</p>
<p>;; Listen for all events and setup a catch-all-stray handler.  (req-event  conn  (fn [conn event]  (println event))  :event-name “ALL”)</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L592">view source</a></div></div><div class="public anchor" id="var-req-sendevent"><h3>req-sendevent</h3><div class="usage"><code>(req-sendevent conn event-name &amp; {:keys [body], :as event-headers})</code></div><div class="doc"><div class="markdown"><p>Send a generated event to freeswitch.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
  <li><code>event-name</code> - The name of the event.</li>
</ul>
<p><strong>Keyword args:</strong></p>
<ul>
  <li><code>:body</code> - (optional) The body of the event.</li>
  <li>Any other keyword arguments are treated as headers for the event.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>Response of the command.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L663">view source</a></div></div><div class="public anchor" id="var-req-sendmsg"><h3>req-sendmsg</h3><div class="usage"><code>(req-sendmsg conn &amp; {:keys [chan-uuid body], :as headers})</code></div><div class="doc"><div class="markdown"><p>Make a ‘sendmsg’ request to control a call.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
</ul>
<p><strong>Kwargs:</strong></p>
<ul>
  <li><code>:chan-uuid</code> - The UUID of target channel. Not required in outbound mode.</li>
  <li><code>:body</code> - (optional) Body of the message.</li>
  <li>Any other keyword arguments are treated as headers for the message.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>Reponse of the command.</p>
<p><strong>Note:</strong></p>
<p>To execute a dialplan app or hangup the call, use higher level funcs like <a href="freeswitch-clj.core.html#var-req-call-execute">req-call-execute</a> which provide automated event listener setup.</p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L688">view source</a></div></div><div class="public anchor" id="var-unbind-event"><h3>unbind-event</h3><div class="usage"><code>(unbind-event conn &amp; {:as event-headers})</code></div><div class="doc"><div class="markdown"><p>Unbind the associated handler for an event.</p>
<p><strong>Args:</strong></p>
<ul>
  <li><code>conn</code> - The connection map.</li>
</ul>
<p><strong>Kwargs:</strong></p>
<p>Event headers to match against.</p>
<p><strong>Returns:</strong></p>
<p><code>nil</code></p></div></div><div class="src-link"><a href="https://github.com/titonbarua/freeswitch-clj/blob/v0.2.2-SNAPSHOT/src/freeswitch_clj/core.clj#L210">view source</a></div></div></div></body></html>